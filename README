概要
MERNアプリ作成mongoDB,express,react,node.js
react, reduxの状態管理
JWTでユーザ認証、ログイン、新規登録API
MaterialUI	
MongoDBとスキーマ
ミドルウェアとバリデーション

フロント答え
https://github.com/Shin-sibainu/notion-clone-client

バックエンド答え
https://github.com/Shin-sibainu/notion-clone-server

#セクション3: 【Notionアプリ開発】バックエンド構築編(Node.jsとMongoDBを使用)
再生
8. Expressフレームワークを使ってローカルサーバーを構築しよう
node -v 16.16.0,npm -v 8.11.0
v22.20.0、11.6.1
requireでexpressを読んで、express()でアプリ作成して、listenでサーバ起動
9. 指定したPORT番号でサーバーが立ち上がるのか確認してみよう
get()でlocalhostにアクセスした時の挙動を定義している。res.sendで描画している

10. Notionユーザー管理の流れを理解してみよう
ユーザ新規登録の流れ
クライアントからリクエストがくる。サーバーがDBにapi経由でsaveするように命令する。
11. ユーザー管理用にMongoDBを利用してみよう

12. ユーザースキーマを構築してみよう
https://mongoosejs.com/docs/index.html
requireで読み込んで、schemaで定義して、modelを作成してexportsで外部公開
13. サーバーとデータベースを接続してみよう
https://mongoosejs.com/docs/connections.html
mongoose.connectでMongoDBと接続している。
14. dotenvモジュールを使ってURLを第三者に見られないように保護しよう
MongoDBの接続情報をそのままGitにあげるのは危ないから環境変数として.envファイルに移しておく。
require(dotenv).configで読み込んで、process.env.MONGO_URLで呼び出す

#セクション4: 【Notionアプリ開発】WebAPI構築編(新規登録、ログイン、JWTトークン発行)
15. ユーザー新規登録API作成の流れ
メールパスワード入力→バリデーションチェック→存在重複確認→PW暗号化→DB保存→JWT発行
16. 早速WebAPIを作成してみよう
postメソッドで作るよ。req.body.passwordで取得するよ。
https://www.npmjs.com/package/crypto-js#aes-encryption
CryptoJSのAES方式でパスワード暗号化するよ
訂正:
- `req.body.password`を扱うには`app.use(express.json())`等のボディパーサーが不可欠です。実装では`server/index.js`でJSONパーサーを有効化していることを確認しておきましょう。
- 依存関係として導入している暗号化ライブラリはnpmパッケージ`crypto-js`です。`require(\"crypto-js\")`で読み込む必要があり、README記載の`CryptoJS`という名前は便宜上の呼称に留めるか、モジュール名に合わせましょう。

17. パスワードを暗号化してユーザーをDBに保存してみよう
https://mongoosejs.com/docs/models.html#constructing-documents
モデルをrequireしてそれにmongooseのcreate関数で登録する。
18. JWTってなに？どの場面で使うの？
JSON Web Token サーバで発行する。ログイン時に一度発行したらクライアントに渡す。複数回ログインしなくてもJWTで認証できる仕組み。
19. JWTをクライアント側に発行してみよう
https://www.npmjs.com/package/jsonwebtoken#jwtsignpayload-secretorprivatekey-options-callback
jsonwebtokenをrequireしてそれのsign()関数にuserid,jwtのシークレットキー、期限切れとかの設定を引数に渡す
新規登録APIが成功したらres.statusに200と、モデルとトークンを返却する、失敗したら500とエラーを返却
20. Postmanをインストールしよう
21. PostmanでWebAPIテストをしてみよう
postメソッドでbodyにusername,password入れてsendした。
返却値はpwは暗号化されてたidもちゃんと作られてた、tokenも長いのが入ってた、
22. express-validatorを使ってバリデーションチェックをはじめよう
https://express-validator.github.io/docs/6.14.0/
express-validatorをrequireして新規登録APIのapp.postの第二引数にbody関数を差し込む。
bodyにisLengthとかwithMessageとかでバリデーションの項目を追加していく
23. すでにDBにユーザーが存在している場合のエラーハンドリング
公式のcustom-error-messageから、findOneメソッドで新規登録項目とDBに重複がないかチェックするバリデータを作成する。
すでに存在していたらPromise.rejectを返却する。
24. バリデーションエラーを出力する機能を実装しよう
これまでに書いたバリデーションをvalidationResult関数から取得してres.statusに乗せて返却する。
next()関数はうまくいかないとそこで止まるようにミドルウェア使う時には必須の関数。
訂正:
- `next()`は自動で「うまくいかないと止まる」ものではなく、バリデーション成功時に開発者が明示的に呼び出して後続ミドルウェアへ処理を渡す関数です。エラーがあればレスポンスを返して終了し、問題なければ`next()`で次へ進めましょう。
25. 正常にバリデーションチェックができているかテストしてみよう
ブラウザのMongoDBproject>clasters>DataExplolerで見れる。
26. 運用・保守しやすくするためにリファクタリングしよう：その１
27. 運用・保守しやすくするためにリファクタリングしよう：その２
server/index.jsにexpress本体とかmongooseとか基本のやつ。
useで認証周りのauth.jsを呼んでる。
server/src/v1/routes/auth.jsに新規登録API
routes/auth.jsから/src/v1/handlers/validation.jsにバリデーション周りを引っ越し
routes/auth.jsから/src/v1/controllers/user.jsにユーザ認証周りを引っ越し

| ディレクトリ           | 役割（ざっくり）                         |
| ---------------- | -------------------------------- |
| **controllers/** | APIの「処理の本体」。登録・ログインなどのロジックを書く場所  |
| **handlers/**    | 共通の処理（バリデーションチェックなど）をまとめる場所      |
| **models/**      | MongoDB（データベース）のスキーマ（設計図）を定義する場所 |
| **routes/**      | URL とコントローラーをつなぐ「受付・振り分け」        |
| **index.js**     | サーバーの入口。Express の初期設定・ルート読み込み    |
| **.env**         | 秘密鍵やDB接続文字列を保存                   |

[クライアント]
    |
POST /api/v1/auth/register
    |
▼ routes/auth.js（受付）
    |
▼ handlers/validation.js（バリデーションチェック）
    |
▼ controllers/user.js（登録ロジック実行）
    |
▼ models/user.js（DBへ保存）
    |
▼ MongoDB（永続化）
訂正:
- 現状の`server/index.js`では`app.use(\"/api/v1/\", require(\"./src/v1/routes/auth\"))`としているため、実際のエンドポイントは`/api/v1/register`および`/api/v1/login`です。`/auth`プレフィックスは付与されていない点に注意してください。

28. ログイン用APIを構築しよう
routes,controllersを作成
29. ログイン時のパスワードの照合をはじめよう
controllersでcrypto-jsを使ってパスワード照合、OKだったらJWTを発行して201statusとuser,tokenを返却

30. ログインAPIをPostmanでテストしてみよう
ちゃんと全部のパターンで確かめる。
username,passwordそれぞれのバリデーションが機能していること。controllerで「無効です」を返すためにreturn忘れないでね。アプリがクラッシュしちゃう。
31. JWT認証APIってなに？
一度ログイン認証したことある人に発行する。何回もログインし直さなくても、DBまで行かなくてもサーバーでJWTを確認するだけで済む。
32. JWT認証APIを作ってみよう
"/verify-token"をroutes/auth.jsに作る、認証するミドルウェアをhandlers/tokenHandlers.jsに作る
33. JWTをデコード(複合)する関数を作成しよう
jwtのbearerのあとのトークンを取り出すためにsplitして取り出す。複合はJWT.verifyで行う。
34. JWTをデコードするミドルウェアを完成させよう
UserモデルとtokenDecodeの返却値をfindByIdで突き合わせる。
35. JWT認証APIをPostmanでテストしよう
POSTメソッドのheaders、keyはauthorization,valueはbearerにloginした時のtokenをくっつける。


#セクション5: 【Notionアプリ開発】フロントエンド構築編(Reactを使用、ルーティング設定と認証ページの構築)
36. Reactでフロントエンド側の開発環境を構築しよう
37. React18からReact17のバージョンへダウングレードしよう
38. 認証に関するコンポーネントを用意しよう
client/src/components/layout/AuthLayout.jsx
client/src/pages/Login.jsx
client/src/pages/Register.jsx
39. react-router-domでルーティング設定をはじめよう
BrowserRouter><Routes><Route/>のようにして囲う
親コンポーネントにoutletつけることで親が常に表示される。AuthLayoutが親なので共通するレイアウトに使える。
40. Material UIをインストールしよう
https://mui.com/material-ui/material-icons/?selected=AccessAlarm
インポートしたコンポーネントを使うだけでアイコンが使える。
41. ThemeProviderを利用してアプリ全体のテーマを決定しよう
createTheme関数でテーマを決めてcssbaselineでcssリセットしてThemeProviderで囲うとテーマが適用される。
42. 認証に関する共通ページの構築をはじめよう
Conteiner,boxコンポーネントでcss整えた。　
.imgをインポートしたらそれsrcに直接入れられた。
43. ユーザー新規登録用のページを作成しよう
Boxコンポーネントにcomponent="form"属性をつける、Textfieldコンポーネントを利用する。
44. 送信用ボタンとログイン遷移用のボタンを作成しよう
react-router-domのLinkとtoを使って遷移できる。
45. Axiosインスタンスを導入してAPIを叩く下準備をはじめよう
https://axios-http.com/docs/req_config
46. Axios interceptorsを利用してリクエストの前処理を設定してみよう
https://axios-http.com/docs/interceptors
？getTokenでlocalStorageのJWTを取得する、axiosのinterseptersでheaderに何送るか設定している？
訂正:
- Axiosの`request`インターセプターは必ず変更後の`config`オブジェクト自体を返す必要があります。`client/src/api/axiosClient.js`では`config.headers`を書き換えたうえで`config`をそのまま返しており、この形でないとAxiosがリクエストを発行できない点に注意してください。
47. Axios interceptorsを利用してレスポンスの前処理を設定してみよう
responseは正常だとresponse返して、エラーだとerr.response返す。
48. 認証用APIファイルを用意しておこう
client/src/api/authApi.jsを作って、ここでserverで作った新規登録APIを呼ぶ。
49. フォームから名前やパスワードを取得してみよう
onSubmitで送る。new Formdataを使ってnameをgetする。
50. 実際にユーザー新規登録APIを叩いてユーザー登録してみよう
？？try catchで新規登録APIをclient/src/pages/Register.jsxのhandleSubmitから叩く。
authApi.registerメソッド使って、その後localstorageにトークン保存する？
51. CORSエラーを回避する方法
clientとserverのポート番号が違うとCORSエラーになる。
corsのnpmパッケージを使う。
52. APIを叩くときに404 not foundになったときの対処方法
パスを確認。http://localhost:5003/api/v1/auth/registerをclientで叩いてる。
serverのindexでroute/index.jsに飛ぶ、同階層のauth.jsに飛ぶそこの/registerを叩く。
サーバのroute/index.jsとクライアントの叩く先pages/Register.jsのhandlesubmit→authApi→axiosClientでパス決まってる。
53. 新規登録フォーム入力時のバリデーションチェックをしよう：その１
エラーテキストをuseStateで管理して、エラー状態をlet errorで定義して、
if文でテキストフィールドが空の時、パスワードが確認用と異なる時で出し分ける。helperTextでそれぞれ表示させる。
boxコンポーネントにnoValidateプロパティでhelperTextの表示の仕方を変える。
54. エラーがはっきりと分かるように修正しよう
プロパティにエラーが存在する時赤くする。
error={usernameErrText !== ""}
55. 新規登録フォーム入力時のバリデーションチェックをしよう：その２
axiosClientでエラーをthrowしてなくてclient/src/pages/Register.jsxでcatchできてなかった。
err.data.errorsの配列のparamでusernameとかそれに合わせてmsgをsetUsernameErrTextとかして
server側のバリデーションチェックも入れた。
56. 送信時のローディング設定をしよう
loadingをstateで管理して、フォームと作成ボタンをtrueにさせる、API走った後にtryでもcatchでもfalseにする。
57. ユーザー作成が完了したらホームにリダイレクトさせよう
react-router-domのuseNavigate();を使って作成完了時にnavigate("/")でリダイレクトさせる。
58. 【修正】ローカルストレージにトークンが設定されてない問題を修正しよう
axiosClient.interceptors.response.useの時の正常な時にresponse.dataを返す。
59. ログインページを作成しよう
Registerをコピーして確認用パスワード部分削除
60. ログイン用APIを準備して叩いてみよう
client/src/api/authApi.jsでAPI呼び出し関数loginを定義
catchした時undefinedなのでcatchの形とerrorを定義してる名前と形を確認する。
server/src/v1/controllers/user.jsの返却の値を確認する。
"errors"を配列で囲って、paramプロパティの中を変えて、messageプロパティをmsgにした。
61. クライアントがすでにJWTを持っているかチェックするロジックを作ろう
login,registerの共通箇所client/src/components/layout/AuthLayout.jsxでnavigate使われる時に感知する仕組みを作る。
62. JWTチェック用ファイルを完成させよう
client/src/utils/authUtils.jsでトークンgetしてtryしたらauthApiでAPI呼ぶ
63. 実際にJWTチェックでリダイレクトされる実装をしよう


#セクション6: 【Notionアプリ開発】フロントエンド構築編(Notion画面、サイドバー、Redux、メモAPIの構築)
64. Notion本体の機能実装をするためのルーティング設定をはじめよう
client/src/App.jsにAppLayout,Homeコンポーネントをホームで描画させる。
65. AppLayoutでNotionアプリ共通コンポーネントを作成しよう
client/src/components/layout/AppLayout.jsxでAuthLayoutのロジックを移す。
client/src/components/common/Sidebar.jsxを作成してAppLayoutで描画させる。
66. サイドバーを作ってみよう：その１
Drawer>List>ListItemButton>Typography,IconButton>LogoutIconのように作成
67. サイドバーを作ってみよう：その２
MUIiconで探そう。
68. サイドバーの背景色を変更してみよう
client/src/assets/index.jsで色を指定する。
importしてbackgroundColor: assets.colors.secondaryのように利用する。
69. ページからログアウトする機能を実装しよう
localStorage.removeItem("token")でトークン外せる。
useNavigateでログイン画面に遷移する。
70. ユーザー管理用にReduxを実装しよう
client/src/redux/store.jsを作る。configureStoreでstore定義する。
71. userSliceを実装しよう
initialStateは空なのでsetUserで定義してあげる。
storeのreducerにuserSliceのuserReducerを格納してあげる。
72. グローバルにユーザー管理ができるようにしよう
client/src/index.jsにstoreとProviderをimportしてグローバル管理する。

73. useDispatchとuseSelectorを使ってユーザー保存と取り出しをはじめよう
client/src/components/layout/AppLayout.jsxで初期描画の時にdispatchで登録する。
client/src/components/common/Sidebar.jsxでuseSelector使って取り出して使う。
74. 仮置きでメモを追加してみよう
ListItemButtonで新しく作る。component={Link}で飛ぶ。
75. Notionメモ用のスキーマを作成してみよう
server/src/v1/models/memo.jsを作成type: Schema.types.ObjectIdでユーザ判別用。
76. 【※追加修正】Schemaをインポートしよう
77. メモ新規作成APIを作ってみよう
server/src/v1/controllers/memo.js作成
？何やってるかちょっとわかんない
78. メモAPI用ルーティング設定をしよう
server/src/v1/routes/index.jsとserver/src/v1/routes/memo.jsを作成
?
79. Homeコンポーネントを完成させよう
client/src/pages/Home.jsxにメモ作成ボタンを置いておく。

#セクション7: 【Notionアプリ開発】フロントエンド構築編(メモAPI/データフェッチング)
80. 実際にメモ作成APIを叩いてメモを作成してみよう
client/src/pages/Home.jsxでAPI叩く。client/src/api/memoApi.jsを通す
81. サイドバーの横にメモ専用ページを表示してみよう
client/src/pages/Memo.jsx 
82. ログインしているユーザーが作成したメモを全て取得するAPIを構築しよう
server/src/v1/controllers/memo.jsでgetAllで取得、
server/src/v1/routes/memo.jsでメモ取得
83. APIを叩いてDBにあるメモを取得してみよう
client/src/components/common/Sidebar.jsxでuseEffect使って
memoApi.getAll()する。
84. Reduxでメモをグローバルで管理できる状態にしよう
client/src/redux/features/memoSlice.js
client/src/redux/store.js
client/src/components/common/Sidebar.jsxここでdispatchして登録する。
85. メモをmap関数で全てサイドバーに出力してみよう
mapで描画
86. メモを選択したらハイライトする機能を実装しよう
react-router-domのuseParamsでparamsを取得、memoIdを取得してListItemButtonのselectedをtrueにする処理を追加する。

87. １つのメモを選択して中身を取り出すAPIを構築しよう
server/src/v1/routes/memo.jsでルーティング
server/src/v1/controllers/memo.jsでgetOne,findOne使って取得
88. Memoコンポーネントを作成しよう
client/src/pages/Memo.jsxこれを書いていく

89. MUIのテキストフォームの修正をしてみよう
MuiOutlinedInput-inputなどMUIのclassを直接変更する。

90. １つのメモ情報を取得するAPIを叩いてみよう
client/src/pages/Memo.jsxにuseParamsでいまのメモID取得して、getOneAPIを叩く。

91. 実際にメモのタイトルと詳細を出力してみよう
title,descriptionをstateで保持して、resで取得した値をstate更新関数で代入、コンポーネントのvalueにstateを代入

92. メモ内容更新用APIを構築してみよう
server/src/v1/controllers/memo.jsにupdateのAPIを作成、
server/src/v1/routes/memo.jsでputで更新する
client/src/api/memoApi.jsでidとparamsを引数に取る。paramsで更新内容を受け取る。
93. APIを叩いてメモ内容を更新してみよう
onchangeでupdateTitle関数を呼ぶと、setTitleにe.target.valueを入れて、memoApi.updateで保存する。
94. 時間を空けてAPIを叩く処理を追加してみよう
updateTitle関数内でclearTimeoutで秒数リセット、その中でsetTimeoutで0.5秒ごとにmemoApi.updateを叩くようにする。
95. メモを削除するAPIを構築してみよう
server/src/v1/controllers/memo.jsにdeleteのAPIを作成、
server/src/v1/routes/memo.jsでdeleteで更新する
client/src/api/memoApi.jsでidを引数に取る。

96. 削除したらメモ状態を更新してリダイレクトさせよう
memos.filterでメモのモデルを並び替えて、setMemosで状態更新する。
urlはnavigateで更新する。
97. ＋ボタンでメモを新規追加してみよう
client/src/components/common/Sidebar.jsxに
memoApi.create()で取得したのをdataのところだけ取り出す。そうじゃないとaxiosのレスポンス全体が入ってしまって警告が出る。

#セクション8: 【Notionアプリ開発】フロントエンド構築編(絵文字ピッカー編)
98. 絵文字ピッカー用のコンポーネントを作成しよう
../components/common/EmojiPicker作成、
Memo.jsxからpropsでiconを送る。
99. 絵文字アイコンの大きさ等を修正しよう
Typographyでスタイル修正、useEffect,useStateを準備。
100. 絵文字アイコン用のライブラリをインストールしてみよう
https://www.npmjs.com/package/@emoji-mart/react
昔の使ってるなら、こう。
import "emoji-mart/css/emoji-mart.css";
import { Picker } from "emoji-mart";

101. 絵文字をクリックしてピッカーの表示・非表示を実装しよう
isShowPickerをstateで管理して、onclickでstate反転させる

102. 絵文字コードから絵文字アイコンを取り出してみよう
onEmojiSelect→onSelect
?
103. 変更した絵文字にメモのアイコンを更新しよう
?
propsで絵文字情報を送るのはわかった。